<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Unprivileged Containers</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1>Unprivileged Containers</h1><br />• In an unprivileged container, if anyone gets the root privilege in the container, they can't do anything with root power on the host machine<br />• Limitations: can't mount devices to unprivileged container<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;apt-get&nbsp;<span style="color:#ff9d00;font-weight:700">install</span>&nbsp;lxc&nbsp;uidmap<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;lxc-checkconfig<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;adduser&nbsp;lxcuser<br /><span style="color:#0088ff;font-weight:400">#&nbsp;Allocate&nbsp;subgid&nbsp;and&nbsp;subuid&nbsp;to&nbsp;lxcuser</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;usermod&nbsp;--add-subuids&nbsp;100000-165536&nbsp;lxcuser<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;usermod&nbsp;--add-subgids&nbsp;100000-165536&nbsp;lxcuser<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;<span style="color:#ff9d00;font-weight:700">chmod</span>&nbsp;+x&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>lxcuser<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;create&nbsp;~/.config/lxc/default.conf</span><br />lxc.network.type&nbsp;=&nbsp;veth<br />lxc.network.link&nbsp;=&nbsp;lxcbr0<br />lxc.network.flags&nbsp;=&nbsp;up<br />lxc.network.hwaddr&nbsp;=&nbsp;00<span style="color:#ff9d00;font-weight:700">:</span>16<span style="color:#ff9d00;font-weight:700">:</span>3e<span style="color:#ff9d00;font-weight:700">:</span>xx<span style="color:#ff9d00;font-weight:700">:</span>xx<span style="color:#ff9d00;font-weight:700">:</span>xx<br />lxc.id_map&nbsp;=&nbsp;u&nbsp;0&nbsp;100000&nbsp;65536&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;OR&nbsp;adjust&nbsp;for&nbsp;autocreated&nbsp;values&nbsp;in&nbsp;/etc/subuid</span><br />lxc.id_map&nbsp;=&nbsp;g&nbsp;0&nbsp;100000&nbsp;65536&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;same&nbsp;as&nbsp;above&nbsp;for&nbsp;/etc/subgid</span><br /><br /><span style="color:#ff9d00;font-weight:700">logout</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Create&nbsp;/etc/lxc/lxc-usernet</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;USERNAME&nbsp;TYPE&nbsp;BRIDGE&nbsp;COUNT</span><br />lxcuser&nbsp;veth&nbsp;lxcbr0&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;max&nbsp;of&nbsp;10&nbsp;containers</span><br /><br /><span style="color:#ff9d00;font-weight:700">grep</span>&nbsp;lxcuser&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>sub*&nbsp;2&gt;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;verify&nbsp;subgid&nbsp;&amp;&nbsp;subuid&nbsp;assigned</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Log&nbsp;out/restart,&nbsp;log&nbsp;in&nbsp;as&nbsp;lxcuser</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Download&nbsp;the&nbsp;special&nbsp;image/rootfs:</span><br />﻿lxc-create&nbsp;-t&nbsp;download&nbsp;-n&nbsp;unprivileged&nbsp;--&nbsp;-d&nbsp;ubuntu&nbsp;-r&nbsp;trusty&nbsp;-a&nbsp;amd64<br /><span style="color:#0088ff;font-weight:400">##&nbsp;download&nbsp;is&nbsp;a&nbsp;special&nbsp;type</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;start&nbsp;the&nbsp;container</span><br />lxc-start&nbsp;-n&nbsp;unprivileged&nbsp;-d<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;list&nbsp;container&nbsp;IP</span><br />lxc-ls&nbsp;--fancy<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;ssh&nbsp;in&nbsp;and&nbsp;enjoy&nbsp;(login/pass:&nbsp;ubuntu/ubuntu)</span></div></div><br /><br /><h2>Further Readings</h2><br />• <a href="https://stgraber.org/2013/12/20/lxc-1-0-blog-post-series/">https://stgraber.org/2013/12/20/lxc-1-0-blog-post-series/</a><br />• View “download” available: <a href="https://uk.images.linuxcontainers.org/">Image server for LXC and LXD</a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><p align="center"><img src="images\home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>