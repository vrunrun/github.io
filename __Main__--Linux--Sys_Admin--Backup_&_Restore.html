<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Backup & Restore</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><br /><h1>Backup and Restore with rsync</h1><br /><br /><h2>Prepare Backup drive</h2><br />• Use linux file system e.g. EXT4 on the backup drive. <br />• Don't use FAT file system as rsync won't be able to copy all file attributes<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;mkfs.ext&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>sdb1&nbsp;-L&nbsp;<span style="color:#3ad900;font-weight:400">'label'</span></div></div><br /><br /><h2>Backup</h2><br /><br /> <div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;rsync&nbsp;-aAXv&nbsp;--delete&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>proc<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>sys<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>run<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">/</span>media<span style="color:#ff9d00;font-weight:700">/</span>*&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">"swapfile"</span>&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">"lost+found"</span>&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">".cache"</span>&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">"Downloads"</span>&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">".VirtualBoxVMs"</span>&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">".ecryptfs"</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>source&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>destination<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;-a,&nbsp;--archive&nbsp;&nbsp;&nbsp;archive&nbsp;mode</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;-A,&nbsp;--acls&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preserve&nbsp;ACLs&nbsp;(Access&nbsp;Control&nbsp;List)</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;-X,&nbsp;--xattrs&nbsp;&nbsp;&nbsp;&nbsp;preserve&nbsp;extended&nbsp;attributes</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;-v,&nbsp;--verbose&nbsp;&nbsp;&nbsp;increase&nbsp;verbosity</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;--delete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;incremental&nbsp;backup</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;--dry-run&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simulate&nbsp;the&nbsp;backup</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;/source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use&nbsp;/&nbsp;(root)&nbsp;for&nbsp;everything</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;/destination&nbsp;&nbsp;&nbsp;&nbsp;e.g.&nbsp;/media/user/drive</span></div></div><br /> <br />  <div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Alternate&nbsp;syntax</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;rsync&nbsp;-aAXv&nbsp;--delete&nbsp;--exclude=<span style="color:#ff9d00;font-weight:700">{/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>proc<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>sys<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>tmp<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>run<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>media<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>*,<span style="color:#ff9d00;font-weight:700">/</span>lost+found<span style="color:#ff9d00;font-weight:700">}</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>home&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>media<span style="color:#ff9d00;font-weight:700">/</span>mainpool<span style="color:#ff9d00;font-weight:700">/</span>backups</div></div> <br /><br />• For testing, remove the /boot directory from your source. The system will fail to boot<br /> <br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;<span style="color:#ff9d00;font-weight:700">rm</span>&nbsp;-rf&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>boot</div></div><br /><br />• Boot from live ISO<br /><br /><h2>Mount fs and usb drive</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">mkdir</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>system&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>usb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;mount&nbsp;points</span><br />lsblk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;check&nbsp;names&nbsp;of&nbsp;devices</span><br /><span style="color:#ff9d00;font-weight:700">mount</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>sda1&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>system<br /><span style="color:#ff9d00;font-weight:700">mount</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>dev<span style="color:#ff9d00;font-weight:700">/</span>sdb1&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>usb</div></div><br /><br />• Verify by checking the contents<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>system&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;should&nbsp;have&nbsp;no&nbsp;/boot&nbsp;directory</span><br /><span style="color:#ff9d00;font-weight:700">ls</span><br /><span style="color:#ff9d00;font-weight:700">cd</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>usb<br /><span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;should&nbsp;see&nbsp;the&nbsp;/boot&nbsp;directory</span><br /></div></div><br /><br /><h2>Restore</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;rsync&nbsp;-aAXv&nbsp;--delete&nbsp;--exclude=<span style="color:#3ad900;font-weight:400">"lost+found"</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>usb<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>system<br /><span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>mnt<span style="color:#ff9d00;font-weight:700">/</span>system&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;verify</span></div></div><br /><br />• Remove live ISO and Reboot<br /><br /><h2>Schedule Backup</h2><br /><br /><div class="codebox"><div class="codebox">crontab&nbsp;-e</div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Inside&nbsp;crontab</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;m(minute)&nbsp;h(hour)&nbsp;dom(day_of_month)&nbsp;mon(month)&nbsp;dow(day_of_week)&nbsp;command</span><br /><br />00&nbsp;12&nbsp;*&nbsp;*&nbsp;*&nbsp;rsync&nbsp;-aAX&nbsp;--delete&nbsp;--exclude&nbsp;<span style="color:#3ad900;font-weight:400">'*.Trash-1000'</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>source<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>backup<span style="color:#ff9d00;font-weight:700">/</span>daily<br />00&nbsp;15&nbsp;*&nbsp;*&nbsp;5&nbsp;rsync&nbsp;-aAX&nbsp;--delete&nbsp;--exclude&nbsp;<span style="color:#3ad900;font-weight:400">'*.Trash-1000'</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>source<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>backup<span style="color:#ff9d00;font-weight:700">/</span>weekly<br />00&nbsp;16&nbsp;1&nbsp;*&nbsp;*&nbsp;rsync&nbsp;-aAX&nbsp;--delete&nbsp;--exclude&nbsp;<span style="color:#3ad900;font-weight:400">'*.Trash-1000'</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>source<span style="color:#ff9d00;font-weight:700">/</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>backup<span style="color:#ff9d00;font-weight:700">/</span>monthly_$<span style="color:#ff9d00;font-weight:700">(date</span>&nbsp;+%Y%m%d<span style="color:#ff9d00;font-weight:700">)</span></div></div><br /><p align="center"><img src="images\home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>