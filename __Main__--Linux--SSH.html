<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SSH</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><br /><h1>SSH</h1><br /><br /><h2>Manual Page</h2><br /><a href="https://www.openssh.com/manual.html">OpenSSH Manual Pages</a><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Login</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;username@remote_host<br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;username@ip_address<br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;-p&nbsp;80&nbsp;root@demo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;-p&nbsp;specify&nbsp;port&nbsp;number&nbsp;(default=22)</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;severname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;login&nbsp;with&nbsp;the&nbsp;same&nbsp;username</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Logout</h2><br /><br /><div class="codebox"><div class="codebox">ctrl<span style="color:#ffdd00;font-weight:400">-d</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">logout</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Set up SSH</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;On&nbsp;server</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;apt&nbsp;<span style="color:#ff9d00;font-weight:700">install</span>&nbsp;openssh-server<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;netstat&nbsp;tupln&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;port&nbsp;22&nbsp;is&nbsp;opened</span></div></div><br /><br /><a name="Generate SSH Key"></a><h2>Set up Public/ Private Key Authentication</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;On&nbsp;client</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Generate&nbsp;public&nbsp;and&nbsp;private&nbsp;key</span><br /><span style="color:#ff9d00;font-weight:700">ssh-keygen</span>&nbsp;-t&nbsp;ed25519&nbsp;-C&nbsp;<span style="color:#3ad900;font-weight:400">"tim@debian"</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;-t:&nbsp;Type&nbsp;of&nbsp;alogorithm&nbsp;(default&nbsp;=&nbsp;rsa);&nbsp;-C:&nbsp;comment</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">ssh-keygen</span>&nbsp;-t&nbsp;rsa&nbsp;-b&nbsp;4096<br /><br /><span style="color:#ff9d00;font-weight:700">ls</span>&nbsp;.<span style="color:#ff9d00;font-weight:700">/ssh</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Copy&nbsp;public&nbsp;key&nbsp;to&nbsp;remote&nbsp;ssh&nbsp;server</span><br />ssh-copy-id&nbsp;tim@demo.net<br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">scp</span>&nbsp;.<span style="color:#ff9d00;font-weight:700">/ssh/</span>id_rsa_pub&nbsp;ubuntu@10.0.3.170&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>home<span style="color:#ff9d00;font-weight:700">/</span>ubuntu<br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;~<span style="color:#ff9d00;font-weight:700">/</span>.ssh<span style="color:#ff9d00;font-weight:700">/</span>id_ed25519.pub&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;<span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;tim@demo.net&nbsp;<span style="color:#3ad900;font-weight:400">"mkdir&nbsp;-p&nbsp;~/.ssh&nbsp;&amp;&amp;&nbsp;cat&nbsp;&gt;&gt;&nbsp;~/.ssh/authorized_keys"</span></div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;On&nbsp;server</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Verify&nbsp;public&nbsp;key&nbsp;is&nbsp;there</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;tim@demo.net&nbsp;<span style="color:#3ad900;font-weight:400">"cat&nbsp;~/.ssh/authorized_keys"</span><br /><span style="color:#ff9d00;font-weight:700">chmod</span>&nbsp;-R&nbsp;700&nbsp;.ssh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;Security</span><br /><span style="color:#ff9d00;font-weight:700">cp</span>&nbsp;id_rsa_pub&nbsp;.ssh<span style="color:#ff9d00;font-weight:700">/</span>authorized_keys</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>SSH Server Hardening</h2><br />• <a href="https://infosec.mozilla.org/guidelines/openssh">Guidelines</a><br />• Disable login as root<br />• Disable password based login<br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Change&nbsp;in&nbsp;config&nbsp;file</span><br />nano&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/ssh/</span>sshd_config<br /><span style="color:#0088ff;font-weight:400">##&nbsp;Port&nbsp;443&nbsp;(optional)</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;ChallengeResponseAuthentication&nbsp;no</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;PasswordAuthentication&nbsp;no</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;UsePAM&nbsp;no</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;PubkeyAuthentication&nbsp;yes</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;PermitRootLogin&nbsp;prohibit-password</span></div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Restart&nbsp;ssh&nbsp;service</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;service&nbsp;sshd&nbsp;restart<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;netstat&nbsp;-tupln</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Other commands</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">ssh-add</span>&nbsp;-l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;list&nbsp;fingerprints</span><br /><span style="color:#ff9d00;font-weight:700">ssh-add</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>path<span style="color:#ff9d00;font-weight:700">/</span>to<span style="color:#ff9d00;font-weight:700">/</span>private_key<br /><span style="color:#ff9d00;font-weight:700">ssh-add</span>&nbsp;-d&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>path<span style="color:#ff9d00;font-weight:700">/</span>to<span style="color:#ff9d00;font-weight:700">/</span>private_key<br /><span style="color:#ff9d00;font-weight:700">ssh-add</span>&nbsp;-D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;delete&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;ssh&nbsp;tunneling</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;-tt&nbsp;user@ip1&nbsp;<span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;-tt&nbsp;user2@ip2</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Using SSH SOCKS Proxy to Browse the Web Safely</h2><br />• Prerequisites:<br />   ◇ An existing SSH server, accessible from the Internet<br />   ◇ Client public key in SSH server<br />• Protect your privacy if you're connected to the Internet over public Wi-Fi<br />• Client → SSH Server → Internet<br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;On&nbsp;server</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;nano&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/ssh/</span>sshd_config<br /><span style="color:#0088ff;font-weight:400">#&nbsp;In&nbsp;the&nbsp;file,&nbsp;uncomment&nbsp;Port&nbsp;22&nbsp;and&nbsp;change&nbsp;it&nbsp;to:</span><br />Port&nbsp;443<br /><span style="color:#0088ff;font-weight:400">#&nbsp;Restart&nbsp;service</span><br />service&nbsp;sshd&nbsp;restart</div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;On&nbsp;client</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Setup&nbsp;ssh&nbsp;tunnel</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;-N&nbsp;-D&nbsp;8080&nbsp;user@server_address&nbsp;-p&nbsp;443<br /><span style="color:#0088ff;font-weight:400">##&nbsp;-N:&nbsp;no&nbsp;login</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;D:&nbsp;bind&nbsp;to&nbsp;local&nbsp;port</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Setup&nbsp;browser</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;SOCKS&nbsp;Host&nbsp;@127.0.0.1:8080</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>SSH Aliases &amp; SSH Config FIle</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">cat</span>&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/ssh/</span>ssh_config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;system-wide&nbsp;config&nbsp;file</span><br />nano&nbsp;.<span style="color:#ff9d00;font-weight:700">/ssh/</span>config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;user&nbsp;config&nbsp;file</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;not&nbsp;exist&nbsp;by&nbsp;default</span></div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Sample&nbsp;user&nbsp;config&nbsp;file</span><br />Host&nbsp;*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAliveInterval&nbsp;300&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;seconds</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerAliveCountMax&nbsp;2<br /><br />Host&nbsp;lxc<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostName&nbsp;10.0.3.152<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;jdenton<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Port&nbsp;1999<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityFile&nbsp;~<span style="color:#ff9d00;font-weight:700">/</span>.ssh<span style="color:#ff9d00;font-weight:700">/</span>alternate.key&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;optional</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />Host&nbsp;webdev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;ssh&nbsp;local&nbsp;forwarding</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostName&nbsp;Internet-facing.machine.com<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LocalForward&nbsp;8080&nbsp;192.168.80.3<span style="color:#ff9d00;font-weight:700">:</span>80<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;all&nbsp;others&nbsp;to&nbsp;use&nbsp;this&nbsp;fwd</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GatewayPorts&nbsp;yes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div><br /><br /><h2>Local forwarding</h2><br />• take a port of the remote machine and access it in local machine<br />• localhost → Internet-facing.machine.com (SSH) → webdev:80<br /><br /><h2>Remote forwarding</h2><br />• make a port of local machine available to remote machine <br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Using&nbsp;ssh&nbsp;alias</span><br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;lxc<br /><span style="color:#ff9d00;font-weight:700">ssh</span>&nbsp;-f&nbsp;-N&nbsp;webdev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;ssh&nbsp;local&nbsp;forwarding</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;-f&nbsp;forward</span><br /><span style="color:#0088ff;font-weight:400">##&nbsp;-N&nbsp;no&nbsp;login</span></div></div><br /><br /><h2>Further Reading</h2><br />• <em>man ssh_config</em><br />• <a href="https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding#Forwarding_GUI_Programs">Port Forwarding Explained</a><br /><br /><br /><p align="center"><img src="images\home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>