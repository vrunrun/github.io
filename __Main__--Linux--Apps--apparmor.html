<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>apparmor</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1>Apparmor</h1><br />• A security framework for isolation and application control<br />• Included in Ubuntu and Debian 10<br /><br /><h2>Install</h2><br /><br /><div class="codebox"><div class="codebox">apt&nbsp;<span style="color:#ff9d00;font-weight:700">install</span>&nbsp;apparmor&nbsp;apparmor-utils<br />apt&nbsp;<span style="color:#ff9d00;font-weight:700">install</span>&nbsp;apparmor-profiles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;additional&nbsp;profiles</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Activate Apparmor on Start-up</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;nano&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>default<span style="color:#ff9d00;font-weight:700">/</span>grub<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Change&nbsp;the&nbsp;following&nbsp;line&nbsp;GRUB_CMDLINE_LINUX_DEFAULT="quiet"&nbsp;to</span><br /><span style="color:#7f0044;font-weight:400">GRUB_CMDLINE_LINUX_DEFAULT</span>=<span style="color:#3ad900;font-weight:400">"quiet&nbsp;apparmor=1&nbsp;security=apparmor"</span><br /><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;update-grub<br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;reboot</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Check status</h2><br /><br /><div class="codebox"><div class="codebox">systemctl&nbsp;status&nbsp;apparmor<br /><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;aa-status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;requires&nbsp;apparmor-utils</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;apparmor_status</div></div><br /><br />• List the programs which have no associated profile and which expose an open network socket<br /><br /><div class="codebox"><div class="codebox">﻿aa-unconfined</div></div><br /><br />• List running executables which are currently confined by apparmor<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">ps</span>&nbsp;auxZ&nbsp;<span style="color:#ff9d00;font-weight:700">|</span>&nbsp;<span style="color:#ff9d00;font-weight:700">grep</span>&nbsp;-v&nbsp;<span style="color:#3ad900;font-weight:400">'^unconfined'</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Enable/ Disable apparmor</h2><br /><br /><div class="codebox"><div class="codebox">systemctl&nbsp;start&nbsp;apparmor<br />systemctl&nbsp;disable&nbsp;apparmor</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Load and Unload a Profile</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Unload&nbsp;the&nbsp;profile</span><br />apparmor_parser&nbsp;-R&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>path<span style="color:#ff9d00;font-weight:700">/</span>to<span style="color:#ff9d00;font-weight:700">/</span>profile<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Load&nbsp;a&nbsp;profile</span><br />apparmor_parser&nbsp;-r&nbsp;-W&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>path<span style="color:#ff9d00;font-weight:700">/</span>to<span style="color:#ff9d00;font-weight:700">/</span>profile</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Create a Profile</h2><br />• Requires package “apparmor-utils”<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;aa-genprof&nbsp;&lt;executables_name&gt;</div></div><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;Example</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Open&nbsp;a&nbsp;terminal&nbsp;#1</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;aa-genprof&nbsp;apache2<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Open&nbsp;another&nbsp;terminal&nbsp;#2</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;service&nbsp;apache2&nbsp;stop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">#&nbsp;shutdown&nbsp;apache</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;service&nbsp;apache2&nbsp;restart<br /><span style="color:#0088ff;font-weight:400">#&nbsp;Refresh&nbsp;the&nbsp;webpage&nbsp;and&nbsp;browse&nbsp;wp-admin</span><br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;Go&nbsp;back&nbsp;to&nbsp;terminal&nbsp;#1&nbsp;and&nbsp;choose&nbsp;(S)can</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;You&nbsp;will&nbsp;be&nbsp;asked&nbsp;a&nbsp;series&nbsp;of&nbsp;questions&nbsp;for&nbsp;granting&nbsp;access&nbsp;to&nbsp;files,&nbsp;choose&nbsp;(A)llow/&nbsp;(D)eny/&nbsp;(G)lob&nbsp;...</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;(S)ave&nbsp;changes&nbsp;and&nbsp;(F)inish</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Assign Operating Mode to Profile Created</h2><br /><br />• There are 3 operating modes:<br />   ◇ Enforcing (default)<br />      ▪ Denies all unauthorized actions (without asking)<br />      ▪ May break the site<br /><br />   ◇ Complain<br />      ▪ Tells us something would be denied and prompt us to fix it<br /><br />   ◇ Un-confined<br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;To&nbsp;test&nbsp;out&nbsp;new&nbsp;profile,&nbsp;assign&nbsp;to&nbsp;complain&nbsp;mode</span><br />aa-complain&nbsp;apache2<br /><br /><span style="color:#0088ff;font-weight:400">#&nbsp;You&nbsp;will&nbsp;then&nbsp;be&nbsp;prompted&nbsp;for&nbsp;further&nbsp;action&nbsp;on&nbsp;any&nbsp;activity&nbsp;that&nbsp;is&nbsp;not&nbsp;defined&nbsp;in&nbsp;the&nbsp;original&nbsp;profile</span></div></div><br /><br />Course of actions<br />• ﻿Inherit: Creates a rule that is denoted by “ix” within the profile, causes the executed binary to inherit permissions from the parent profile.<br />• Child: Creates a rule that is denoted by “Cx” within the profile, requires a sub-profile to be created within the parent profile and rules must be separately generated for this child (prompts will appear when running scans on the parent).<br />• Deny: Creates a rule that AppArmor prepends with “deny” at the start of the line within the profile, causes the parents access to the resource be denied.<br />• Abort: Exits the AppArmor program without saving any changes.<br />• Finish: Exits the AppArmor program but WILL save changes<br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#&nbsp;After&nbsp;testing,&nbsp;put&nbsp;profile&nbsp;to&nbsp;enforce&nbsp;mode</span><br />aa-enforce&nbsp;apache2</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Enable logging</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">sudo</span>&nbsp;aa-logprof<br /><span style="color:#0088ff;font-weight:400">#&nbsp;or</span><br /><span style="color:#ff9d00;font-weight:700">tail</span>&nbsp;-f&nbsp;<span style="color:#ff9d00;font-weight:700">/</span>var<span style="color:#ff9d00;font-weight:700">/</span>log<span style="color:#ff9d00;font-weight:700">/</span>syslog</div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Config Files Location</h2><br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">/</span>etc<span style="color:#ff9d00;font-weight:700">/</span>apparmor.d<span style="color:#ff9d00;font-weight:700">/</span><br /><span style="color:#0088ff;font-weight:400">#&nbsp;You&nbsp;may&nbsp;manually&nbsp;add&nbsp;wildcards&nbsp;in&nbsp;the&nbsp;config&nbsp;file</span></div></div><br /><br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br /><h2>Further Readings</h2><br /><br />• <a href="https://wiki.debian.org/AppArmor/HowToUse">https://wiki.debian.org/AppArmor/HowToUse</a><br />• <a href="https://www.youtube.com/watch?v=zPkrcTidwQI">YouTube: How to Install and Configure Apparmor on Linux</a><br /><br /><br /><p align="center"><img src="images\home.png" height="22" width="22">  <a href="index.html">Index</a></p></body></html>